on: workflow_dispatch

env: 
  CARGO_TERM_COLOR: always
  CARGO_REGISTRY_TOKEN: ${{secrets.CARGO_TOKEN}}

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: dtolnay/rust-toolchain@stable
        with:
          components: clippy, rustfmt
      - run: cargo install cargo-edit sd
      - id: release
        uses: oknozor/cocogitto-action@v3
        with:
          release: true
          git-user: "Mitch"
          git-user-email: "open.source@quiet.camp"
      - run: cog changelog --at ${{ steps.release.outputs.version }}
      - run: cargo publish
      - uses: softprops/action-gh-release@v2
        with:
          body_path: CHANGELOG.md
          tag_name: ${{ steps.release.outputs.version }}
